# arc_twitter_intents v1.0-dev
# Twitter Web Intents
# Andy Carter
# http://redhotchilliproject.com/

# ......................................................................
# This is a plugin for Textpattern - http://textpattern.com/
# To install: textpattern > admin > plugins
# Paste the following text into the 'Install plugin' box:
# ......................................................................

YToxMTp7czo0OiJuYW1lIjtzOjE5OiJhcmNfdHdpdHRlcl9pbnRlbnRzIjtzOjc6InZlcnNp
b24iO3M6NzoiMS4wLWRldiI7czo2OiJhdXRob3IiO3M6MTE6IkFuZHkgQ2FydGVyIjtzOjEw
OiJhdXRob3JfdXJpIjtzOjMxOiJodHRwOi8vcmVkaG90Y2hpbGxpcHJvamVjdC5jb20vIjtz
OjExOiJkZXNjcmlwdGlvbiI7czoxOToiVHdpdHRlciBXZWIgSW50ZW50cyI7czo1OiJvcmRl
ciI7czoxOiI1IjtzOjQ6InR5cGUiO3M6MToiMCI7czo1OiJmbGFncyI7czoxOiIzIjtzOjQ6
ImhlbHAiO3M6Njk6Igk8aDEgY2xhc3M9InRpdGxlIj48c3BhbiBjbGFzcz0iY2FwcyI+VFhQ
PC9zcGFuPiBUd2VldCBJbnRlbnRzPC9oMT4KCiI7czo0OiJjb2RlIjtzOjQ0OTg6Imdsb2Jh
bCAkcHJlZnMsJHR4cGNmZzsKCi8vIGFyY190d2l0dGVyX2ludGVudHMgcmVxdWlyZXMgYXJj
X3R3aXR0ZXIgdjMgb3IgaGlnaGVyCnJlcXVpcmVfcGx1Z2luKCdhcmNfdHdpdHRlcicpOwoK
ZnVuY3Rpb24gYXJjX3R3aXR0ZXJfaW50ZW50X2ZvbGxvdygkYXR0cywgJHRoaW5nPW51bGwp
CnsKICAgIGdsb2JhbCAkcHJlZnM7CgogICAgZXh0cmFjdChsQXR0cyhhcnJheSgKICAgICAg
ICAndXNlcicgICAgICA9PiAkcHJlZnNbJ2FyY190d2l0dGVyX3VzZXInXSwKICAgICAgICAn
dXNlcl9pZCcgICA9PiAnJywKICAgICAgICAnbGFuZycgICAgICA9PiAnJywKICAgICAgICAn
aW5jbHVkZV9qcyc9PiB0cnVlLAogICAgICAgICdvcHRpbWlzZV9qcycgPT4gZmFsc2UsCiAg
ICAgICAgJ2NsYXNzJyAgICAgPT4gJycKICAgICksJGF0dHMpKTsKCiAgICAkcSA9ICgkdXNl
cl9pZCkgPyAndXNlcl9pZD0nLiR1c2VyX2lkIDogJ3NjcmVlbl9uYW1lPScuJHVzZXI7Cgog
ICAgJGxhbmcgPSBfYXJjX3R3aXR0ZXJfaW50ZW50c19sYW5nKCRsYW5nKTsKICAgICRxIC49
ICcmYW1wO2xhbmc9Jy51cmxlbmNvZGUoJGxhbmcpOwoKICAgICR0aGluZyA9ICgkdGhpbmc9
PT1udWxsKSA/ICdGb2xsb3cnIDogcGFyc2UoJHRoaW5nKTsKCiAgICAkaHRtbCA9IGhyZWYo
JHRoaW5nLCdodHRwOi8vdHdpdHRlci5jb20vaW50ZW50L3VzZXI/Jy4kcQogICAgICAsICcg
Y2xhc3M9IicuJGNsYXNzLiciJyk7CgogICAgJGpzID0gKCRpbmNsdWRlX2pzKSA/IF9hcmNf
dHdpdHRlcl93aWRnZXRfanMoJG9wdGltaXNlX2pzP3RydWU6ZmFsc2UpIDogJyc7CgogICAg
cmV0dXJuICRqcy4kaHRtbDsKfQoKZnVuY3Rpb24gYXJjX3R3aXR0ZXJfaW50ZW50X2Zhdm9y
aXRlKCRhdHRzLCAkdGhpbmc9bnVsbCkKewogICAgZ2xvYmFsICRwcmVmcywgJHRoaXNhcnRp
Y2xlOwoKICAgIGV4dHJhY3QobEF0dHMoYXJyYXkoCiAgICAgICAgJ3VzZXInICAgICAgPT4g
JHByZWZzWydhcmNfdHdpdHRlcl91c2VyJ10sCiAgICAgICAgJ3JlbGF0ZWQnICAgPT4gJycs
CiAgICAgICAgJ2luY2x1ZGVfanMnPT4gdHJ1ZSwKICAgICAgICAnb3B0aW1pc2VfanMnID0+
IGZhbHNlLAogICAgICAgICdsYW5nJyAgICAgID0+ICcnLAogICAgICAgICdpZCcgICAgICAg
ID0+ICcnLAogICAgICAgICdjbGFzcycgICAgID0+ICcnCiAgICApLCRhdHRzKSk7CgogICAg
aWYgKCRpZCB8fCAkdGhpc2FydGljbGVbJ3RoaXNpZCddKSB7CgogICAgICAkcSA9ICdyZWxh
dGVkPScuJHVzZXI7CiAgICAgIGlmICgkcmVsYXRlZCkgJHEgLj0gdXJsZW5jb2RlKCgkcT8n
LCc6J3JlbGF0ZWQ9JykuJHJlbGF0ZWQpOwoKICAgICAgaWYgKCEkaWQpIHsKICAgICAgICAk
cm93ID0gc2FmZV9yb3coInR3ZWV0X2lkIgogICAgICAgICwgJ2FyY190d2l0dGVyJywgImFy
dGljbGVfaWQ9eyR0aGlzYXJ0aWNsZVsndGhpc2lkJ119Iik7CiAgICAgICAgaWYgKCEkaWQg
PSAkcm93Wyd0d2VldF9pZCddKSByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgICRxIC49
ICcmYW1wO3R3ZWV0X2lkPScuJGlkOwoKICAgICAgJGxhbmcgPSBfYXJjX3R3aXR0ZXJfaW50
ZW50c19sYW5nKCRsYW5nKTsKICAgICAgJHEgLj0gJyZhbXA7bGFuZz0nLnVybGVuY29kZSgk
bGFuZyk7CgogICAgICAkdGhpbmcgPSAoJHRoaW5nPT09bnVsbCkgPyAnRmF2b3JpdGUnIDog
cGFyc2UoJHRoaW5nKTsKCiAgICAgICRodG1sID0gaHJlZigkdGhpbmcsJ2h0dHA6Ly90d2l0
dGVyLmNvbS9pbnRlbnQvZmF2b3JpdGU/Jy4kcQogICAgICAgICwgJyBjbGFzcz0iJy4kY2xh
c3MuJyInKTsKCiAgICAgICRqcyA9ICgkaW5jbHVkZV9qcykgPyBfYXJjX3R3aXR0ZXJfd2lk
Z2V0X2pzKCRvcHRpbWlzZV9qcz90cnVlOmZhbHNlKSA6ICcnOwoKICAgICAgcmV0dXJuICRq
cy4kaHRtbDsKCiAgICB9CgogICAgcmV0dXJuIGZhbHNlOwp9CgpmdW5jdGlvbiBhcmNfdHdp
dHRlcl9pbnRlbnRfcmV0d2VldCgkYXR0cywgJHRoaW5nPW51bGwpCnsKICAgIGdsb2JhbCAk
cHJlZnMsICR0aGlzYXJ0aWNsZTsKCiAgICBleHRyYWN0KGxBdHRzKGFycmF5KAogICAgICAg
ICd1c2VyJyAgICAgID0+ICRwcmVmc1snYXJjX3R3aXR0ZXJfdXNlciddLAogICAgICAgICdy
ZWxhdGVkJyAgID0+ICcnLAogICAgICAgICdpbmNsdWRlX2pzJz0+IHRydWUsCiAgICAgICAg
J29wdGltaXNlX2pzJyA9PiBmYWxzZSwKICAgICAgICAnbGFuZycgICAgICA9PiAnJywKICAg
ICAgICAnaWQnICAgICAgICA9PiAnJywKICAgICAgICAnY2xhc3MnICAgICA9PiAnJwogICAg
KSwkYXR0cykpOwoKICAgIGlmICgkaWQgfHwgJHRoaXNhcnRpY2xlWyd0aGlzaWQnXSkgewoK
ICAgICAgJHEgPSAncmVsYXRlZD0nLiR1c2VyOwogICAgICBpZiAoJHJlbGF0ZWQpICRxIC49
IHVybGVuY29kZSgoJHE/JywnOidyZWxhdGVkPScpLiRyZWxhdGVkKTsKCiAgICAgIGlmICgh
JGlkKSB7CiAgICAgICAgJHJvdyA9IHNhZmVfcm93KCJ0d2VldF9pZCIKICAgICAgICAsICdh
cmNfdHdpdHRlcicsICJhcnRpY2xlX2lkPXskdGhpc2FydGljbGVbJ3RoaXNpZCddfSIpOwog
ICAgICAgIGlmICghJGlkID0gJHJvd1sndHdlZXRfaWQnXSkgcmV0dXJuIGZhbHNlOwogICAg
ICB9CgogICAgICAkcSAuPSAnJmFtcDt0d2VldF9pZD0nLiRpZDsKCiAgICAgICRsYW5nID0g
X2FyY190d2l0dGVyX2ludGVudHNfbGFuZygkbGFuZyk7CiAgICAgICRxIC49ICcmYW1wO2xh
bmc9Jy51cmxlbmNvZGUoJGxhbmcpOwoKICAgICAgJHRoaW5nID0gKCR0aGluZz09PW51bGwp
ID8gJ1JldHdlZXQnIDogcGFyc2UoJHRoaW5nKTsKCiAgICAgICRodG1sID0gaHJlZigkdGhp
bmcsJ2h0dHA6Ly90d2l0dGVyLmNvbS9pbnRlbnQvcmV0d2VldD8nLiRxCiAgICAgICAgLCAn
IGNsYXNzPSInLiRjbGFzcy4nIicpOwoKICAgICAgJGpzID0gKCRpbmNsdWRlX2pzKSA/IF9h
cmNfdHdpdHRlcl93aWRnZXRfanMoJG9wdGltaXNlX2pzP3RydWU6ZmFsc2UpIDogJyc7Cgog
ICAgICByZXR1cm4gJGpzLiRodG1sOwoKICAgIH0KCiAgICByZXR1cm4gZmFsc2U7Cn0KCmZ1
bmN0aW9uIGFyY190d2l0dGVyX2ludGVudF9yZXBseSgkYXR0cywgJHRoaW5nPW51bGwpCnsK
ICAgIGdsb2JhbCAkcHJlZnMsICR0aGlzYXJ0aWNsZTsKCiAgICBleHRyYWN0KGxBdHRzKGFy
cmF5KAogICAgICAgICd1c2VyJyAgICAgID0+ICRwcmVmc1snYXJjX3R3aXR0ZXJfdXNlcidd
LAogICAgICAgICdyZWxhdGVkJyAgID0+ICcnLAogICAgICAgICd0ZXh0JyAgICAgID0+ICcn
LAogICAgICAgICdpbmNsdWRlX2pzJz0+IHRydWUsCiAgICAgICAgJ29wdGltaXNlX2pzJyA9
PiBmYWxzZSwKICAgICAgICAnbGFuZycgICAgICA9PiAnJywKICAgICAgICAnaWQnICAgICAg
ICA9PiAnJywKICAgICAgICAnY2xhc3MnICAgICA9PiAnJwogICAgKSwkYXR0cykpOwoKICAg
IGlmICgkaWQgfHwgJHRoaXNhcnRpY2xlWyd0aGlzaWQnXSkgewoKICAgICAgaWYgKCEkaWQp
IHsKICAgICAgICAkcm93ID0gc2FmZV9yb3coInR3ZWV0X2lkIgogICAgICAgICwgJ2FyY190
d2l0dGVyJywgImFydGljbGVfaWQ9eyR0aGlzYXJ0aWNsZVsndGhpc2lkJ119Iik7CiAgICAg
ICAgaWYgKCEkaWQgPSAkcm93Wyd0d2VldF9pZCddKSByZXR1cm4gZmFsc2U7CiAgICAgIH0K
CiAgICAgICRxID0gJ2luX3JlcGx5X3RvPScuJGlkOwoKICAgICAgaWYgKCR1c2VyKSB7CiAg
ICAgICAgJHEgLj0gJyZhbXA7cmVsYXRlZD0nLnVybGVuY29kZSgkdXNlcik7CiAgICAgIH0K
ICAgICAgaWYgKCRyZWxhdGVkKSB7CiAgICAgICAgJHEgLj0gdXJsZW5jb2RlKCgkdXNlcj8n
LCc6JyZyZWxhdGVkPScpLiRyZWxhdGVkKTsKICAgICAgfQogICAgICBpZiAoJHRleHQpIHsK
ICAgICAgICAkcSAuPSAnJmFtcDt0ZXh0PScudXJsZW5jb2RlKCR0ZXh0KTsKICAgICAgfQoK
ICAgICAgJGxhbmcgPSBfYXJjX3R3aXR0ZXJfaW50ZW50c19sYW5nKCRsYW5nKTsKICAgICAg
JHEgLj0gJyZhbXA7bGFuZz0nLnVybGVuY29kZSgkbGFuZyk7CgogICAgICAkdGhpbmcgPSAo
JHRoaW5nPT09bnVsbCkgPyAnUmVwbHknIDogcGFyc2UoJHRoaW5nKTsKCiAgICAgICRodG1s
ID0gaHJlZigkdGhpbmcsJ2h0dHA6Ly90d2l0dGVyLmNvbS9pbnRlbnQvdHdlZXQ/Jy4kcQog
ICAgICAgICwgJyBjbGFzcz0iJy4kY2xhc3MuJyInKTsKCiAgICAgICRqcyA9ICgkaW5jbHVk
ZV9qcykgPyBfYXJjX3R3aXR0ZXJfd2lkZ2V0X2pzKCRvcHRpbWlzZV9qcz90cnVlOmZhbHNl
KSA6ICcnOwoKICAgICAgcmV0dXJuICRqcy4kaHRtbDsKCiAgICB9CgogICAgcmV0dXJuIGZh
bHNlOwp9CgovKgogKiBTZXQgdGhlIGludGVudCBsYW5ndWFnZQogKi8KZnVuY3Rpb24gX2Fy
Y190d2l0dGVyX2ludGVudHNfbGFuZygkbGFuZz0nZW4nKQp7CiAgJGxhbmcgPSBzdHJ0b2xv
d2VyKCRsYW5nKTsKICAkbGFuZ3MgPSBhcnJheSgnZW4nLCAnaXQnLCAnZXMnLCAnZnInLCAn
a28nLCAnanAnKTsKICByZXR1cm4gKGluX2FycmF5KCRsYW5nLCRsYW5ncykpID8gJGxhbmcg
OiAnZW4nOwp9CgoiO3M6MzoibWQ1IjtzOjMyOiIxM2I1MTZiMjdkODk0OTdlNDNlMzdmNmIw
MTc5NWEzYyI7fQ==
